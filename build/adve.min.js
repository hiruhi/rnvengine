var thisScript,thisSection,escapeScript,escapeSection,shaking=!1,engine,assets,face2button,face1button;function bgImage(a){return{url:a,width:WIDTH,height:HEIGHT}}function se(a){return{url:a,volume:100}}function startLoading(){engine.ports.isModal.send(!0);engine.ports.loading.send(!0);$("#loader").css({visibility:"visible"})}function endLoading(){$("#loader").css({visibility:"hidden"});engine.ports.loading.send(!1);engine.ports.isModal.send(!1)}
function setShaking(a){engine.ports.shaking.send(a);engine.ports.proceedRequest.send(!0)}function expandMacro(a){for(key in macro)a=a.split(key).join(macro[key]);return a}function setVoice(a){a=voiceTable[a];var b=$("#nameplate");b.empty();b.append('<p id="voice">'+a.name+"</p>");b.css({visibility:"visible","text-shadow":"0px 0px 5px "+a.color+", 0px 0px 5px "+a.color});$("#showscript").css({"text-shadow":"0px 0px 2px "+a.color});engine.ports.proceedRequest.send(!0)}
function jumpEscape(a){a&&(""!=escapeSection&&""!=escapeScript)&&(gotoScript(escapeScript,escapeSection),escapeScript=escapeSection="")}function escapeto(a,b,d){escapeScript=a;escapeSection=b;"undefined"==typeof d?engine.ports.proceedRequest.send(!0):d()}function shakeScreen(){$("#gamescreen").effect("shake",{direction:"up"})}function shake(){shakeScreen();engine.ports.proceedRequest.send(!0)}
function increasingRepeat(a,b,d){for(var c=new String,e=new String,f=0;f<d;f++)e+=b,c+=a,c+=e,c+="\n";return c}function showScript(a){var b=$("#showscript");b.empty();b.append('<p id="serihu">'+a+"</p>");b.css({visibility:"visible"})}function interpretOneStep(a){"undefined"!=typeof a&&a.goForward&&(0==a.script.length?engine.ports.proceedRequest.send(!0):"#"==a.script.charAt(0)?(engine.ports.isModal.send(!0),eval(a.script.substring(1))):(showScript(a.script),engine.ports.isModal.send(!1)))}
function clickAnim(a,b){null==b&&(b=!0);for(key in a)a[key]=assets.images[a[key]];engine.ports.cycledClickAnim.send([a,b]);engine.ports.proceedRequest.send(!0)}function clickAnimOnly(a,b){null==b&&(b=!0);hideScripts();for(key in a)a[key]=assets.images[a[key]];engine.ports.cycledClickAnim.send([a,b]);engine.ports.isModal.send(!0)}function show(a){engine.ports.cycledClickAnim.send([[assets.images[a]],!0]);engine.ports.proceedRequest.send(!0)}
function fadeoutaudio(a,b){if(!(0>a)){for(key in assets.audio){var d=soundManager.getSoundById(key),c=d.volume;1==d.playState&&0!=c&&d.setVolume(Math.max(0,c-assets.audio[key].volume*b))}window.setTimeout(function(){fadeoutaudio(a-1,b)},100)}}function clearCanvas(){engine.ports.clearCanvas.send({width:WIDTH,height:HEIGHT});engine.ports.proceedRequest.send(!0)}
function blackout(a){hideScripts();engine.ports.isModal.send(!0);engine.ports.fadeOut.send(a);fadeoutaudio(10*a,1/(10*a));window.setTimeout(function(){soundManager.stopAll();engine.ports.clearCanvas.send({width:WIDTH,height:HEIGHT});engine.ports.proceedRequest.send(!0);engine.ports.isModal.send(!1)},1E3*(a+0.5))}function hideScripts(){$("#showscript").css({visibility:"hidden"});$("#nameplate").css({visibility:"hidden"})}
function gotoScript(a,b){thisScript=a;thisSection=b;"undefined"==typeof b&&(b="#begin");$("<div>").load(a,null,function(){var a=$(b,this),c=expandMacro(a.text()).replace(/\uff5c([^\u300a]+)\u300a([^\u300b]+)\u300b/g,"<ruby>$1<rp>(</rp><rt>$2</rt><rp>)</rp></ruby>").replace(/\uff56/g,"<span style='color:red'>&hearts;</span>").split("\n");engine.ports.newScript.send(c);a.empty()})}function gotoSection(a){gotoScript(thisScript,a)}function repeatSection(){gotoScript(thisScript,thisSection)}
function gotoEscape(a,b,d){escapeto(a,d,function(){gotoScript(a,b)})}function playLoopCore(a,b){a.play({loop:9999,volume:b,onfinish:function(){playLoopCore(a,b)}})}function playLoop(a){var b=soundManager.getSoundById(a);b&&playLoopCore(b,assets.audio[a].volume);engine.ports.proceedRequest.send(!0)}function playOnce(a){soundManager.play(a,{volume:assets.audio[a].volume});engine.ports.proceedRequest.send(!0)}
function playStop(a){for(key in a)soundManager.stop(a[key]);engine.ports.proceedRequest.send(!0)}function showStandPicts(a){var b=[];for(key in a)b.push({name:key,imageInfo:assets.images[a[key]]});engine.ports.showPicts.send(b);engine.ports.proceedRequest.send(!0)}function changeStandPict(a,b){engine.ports.changePict.send({name:a,imageInfo:assets.images[b]});engine.ports.proceedRequest.send(!0)}function restart(){location.reload()}
function fastFace1button(){engine.ports.face1direct.send(!0);engine.ports.proceedRequest.send(!0)}function slowFace1button(){engine.ports.face1direct.send(!1);engine.ports.proceedRequest.send(!0)};
